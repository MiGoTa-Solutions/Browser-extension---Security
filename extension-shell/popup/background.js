import{t as n}from"./assets/api-C6czKkE_.js";import{r as c,s}from"./assets/chromeStorage-1RTfqZBY.js";chrome.runtime.onInstalled.addListener(async()=>{console.log("[Background] Installed. Syncing..."),await e(),chrome.alarms.create("syncLocks",{periodInMinutes:5})});chrome.alarms.onAlarm.addListener(o=>{o.name==="syncLocks"&&e()});chrome.tabs.onActivated.addListener(()=>{e()});chrome.runtime.onMessage.addListener((o,t,r)=>o.type==="PING"?(r({pong:!0}),!1):o.type==="UNLOCK_SITE"?(console.log(`[Background] Request to unlock: ${o.lockId}`),i(o.lockId,o.pin).then(()=>r({success:!0})).catch(a=>r({success:!1,error:a.message})),!0):!1);async function e(){try{const o=await c();if(!o||!o.token)return;const t=await n.list(o.token);await s(t.locks),console.log(`[Background] Synced ${t.locks.length} locks`)}catch(o){console.error("[Background] Sync failed:",o)}}async function i(o,t){const r=await c();if(!(r!=null&&r.token))throw new Error("Not authenticated");await n.unlock(r.token,o,t),await e()}
