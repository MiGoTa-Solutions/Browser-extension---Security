import{t as c}from"./assets/api-C6czKkE_.js";import{r as a,s}from"./assets/chromeStorage-1RTfqZBY.js";chrome.runtime.onInstalled.addListener(async()=>{console.log("[Background] Installed. Syncing..."),await t(),chrome.alarms?chrome.alarms.create("syncLocks",{periodInMinutes:5}):console.warn('[Background] "alarms" permission missing. Auto-sync disabled.')});chrome.alarms&&chrome.alarms.onAlarm.addListener(o=>{o.name==="syncLocks"&&t()});chrome.tabs.onActivated.addListener(()=>{t()});chrome.runtime.onMessage.addListener((o,r,e)=>o.type==="PING"?(e({pong:!0}),!1):o.type==="UNLOCK_SITE"?(console.log(`[Background] Request to unlock: ${o.lockId}`),i(o.lockId,o.pin).then(()=>e({success:!0})).catch(n=>e({success:!1,error:n.message})),!0):o.type==="CREATE_LOCK"?(console.log("[Background] Request to create lock"),l(o.pin,o.tabs).then(()=>e({success:!0})).catch(n=>e({success:!1,error:n.message})),!0):!1);async function t(){try{const o=await a();if(!o||!o.token)return;const r=await c.list(o.token);console.log("[Background] API Response Locks:",r.locks),await s(r.locks),console.log(`[Background] Synced ${r.locks.length} locks`)}catch(o){console.error("[Background] Sync failed:",o)}}async function i(o,r){const e=await a();if(!(e!=null&&e.token))throw new Error("Not authenticated");await c.unlock(e.token,o,r),await t()}async function l(o,r){const e=await a();if(!(e!=null&&e.token))throw new Error("You must be logged in");const n=`Quick Lock: ${new URL(r[0].url).hostname}`;await c.create(e.token,{name:n,isGroup:!1,tabs:r,pin:o}),await t()}
