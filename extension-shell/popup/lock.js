import"./assets/index-DEzM_D7j.js";const x="http://127.0.0.1:4000/api";document.addEventListener("DOMContentLoaded",()=>{const k=document.getElementById("pinForm"),r=document.getElementById("pin"),p=document.getElementById("errorMsg"),n=document.getElementById("unlockBtn"),h=document.getElementById("lock-title"),u=document.getElementById("header-container"),f=document.getElementById("default-icon"),g=new URLSearchParams(window.location.search),s=g.get("url"),d=g.get("id");if(s&&u)try{const t=new URL(s).hostname,o=`https://www.google.com/s2/favicons?domain=${t}&sz=128`,e=document.createElement("img");e.src=o,e.className="w-16 h-16 rounded-xl shadow-md mx-auto mb-4",e.alt=`${t} icon`,f&&(f.style.display="none"),u.appendChild(e),h&&(h.innerText=`Locked: ${t.replace("www.","")}`)}catch(t){console.error("Favicon load failed",t)}let l=!1;function m(t,o=!1){let e=document.getElementById("lock-toast");if(e)e.lastChild.textContent=t;else{e=document.createElement("div"),e.id="lock-toast",e.style.cssText=`
                position: fixed; top: 24px; left: 50%; transform: translateX(-50%) translateY(-20px);
                padding: 12px 24px; border-radius: 8px; color: white; font-weight: 600; z-index: 100;
                opacity: 0; transition: all 0.3s ease; box-shadow: 0 10px 25px rgba(0,0,0,0.2);
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                display: flex; align-items: center; gap: 8px;
            `;const a=document.createElement("span");a.innerHTML=o?'<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" /></svg>':'<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM3.857 9.309a1 1 0 011.414-1.414L8.586 11.172l6.143-6.143a1 1 0 011.414 1.414l-7.557 7.557a1 1 0 01-1.414 0L3.857 9.309z" clip-rule="evenodd" /></svg>',e.appendChild(a);const i=document.createTextNode(t);e.appendChild(i),document.body.appendChild(e)}e.style.backgroundColor=o?"#ef4444":"#10b981",e.style.transform="translateX(-50%) translateY(0)",e.style.opacity="1",setTimeout(()=>{e.style.opacity="0",e.style.transform="translateX(-50%) translateY(-20px)"},3e3)}const w=()=>{l||(l=!0,s?window.location.href=s:window.close())},y=async()=>{if(!l)try{const t=await chrome.storage.local.get(["lockedSites","unlockedExceptions"]),o=t.lockedSites||[],e=t.unlockedExceptions||[],a=o.find(c=>c.id==d);let i=!1;if(s)try{let c=new URL(s).hostname.toLowerCase();c=c.replace(/^(www\.)/,""),i=e.some(v=>v.includes(c))}catch{}(!a||!a.is_locked||i)&&(console.log("Status change detected. Unlocking..."),w())}catch{}};y(),chrome.storage.onChanged.addListener((t,o)=>{o==="local"&&y()}),k.addEventListener("submit",async t=>{if(t.preventDefault(),l)return;const o=r.value;n.innerHTML='<svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white inline-block" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> Verifying...',n.disabled=!0,p.classList.add("hidden");try{const{auth_token:e}=await chrome.storage.local.get("auth_token");if(!e){m("Please log in to SecureShield extension.",!0),n.disabled=!1,n.textContent="Unlock Access";return}(await fetch(`${x}/auth/verify-pin`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({pin:o})})).ok?(m("Unlocked! Redirecting...",!1),d&&fetch(`${x}/locks/${d}/status`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({is_locked:!1})}).catch(console.error),chrome.runtime.sendMessage({type:"UNLOCK_SITE",url:s}),chrome.runtime.sendMessage({type:"SYNC_LOCKS"}),setTimeout(w,500)):(p.classList.remove("hidden"),r.value="",n.textContent="Unlock Access",n.disabled=!1,r.focus())}catch{m("Connection error.",!0),n.textContent="Unlock Access",n.disabled=!1}})});
