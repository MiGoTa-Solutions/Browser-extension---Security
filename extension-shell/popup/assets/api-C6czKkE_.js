function $(){var e;return typeof chrome<"u"&&((e=chrome.runtime)==null?void 0:e.id)!==void 0}function d(){if($()){const e="http://localhost:4000/api";return console.log("[API] Running in Extension context, using absolute URL:",e),e}else{const e="http://localhost:4000/api".replace(/\/$/,"");return console.log("[API] Running in Web App context, using relative URL:",e),e}}const f=d();function h(e,r,o,s){console.log(`[API Request] ${e} ${r} | Auth: ${o?"âœ“":"âœ—"} | Data: ${s?"âœ“":"âœ—"}`)}function g(e,r,o,s){console.log(`[API Response] ${s?"âœ…":"âŒ"} ${e} ${r} | Status: ${o}`)}function A(e,r,o){o instanceof TypeError&&o.message.includes("fetch")?console.error(`[API Error] âŒ Network Error on ${e} ${r}
  â†’ Likely causes:
    1. Server not running (check http://localhost:4000)
    2. CORS blocked (extension needs absolute URL)
    3. Firewall/network issue
  â†’ Original error: ${o.message}`):o instanceof Error?console.error(`[API Error] âŒ ${e} ${r}: ${o.message}`):console.error(`[API Error] âŒ ${e} ${r}:`,o)}async function t(e,r={}){const{method:o="GET",data:s,token:c}=r,a=`${f}${e}`;h(o,a,!!c,!!s);const u={"Content-Type":"application/json"};c&&(u.Authorization=`Bearer ${c}`);let n;try{n=await fetch(a,{method:o,headers:u,body:s?JSON.stringify(s):void 0})}catch(l){throw A(o,e,l),l}g(o,e,n.status,n.ok);let i;try{i=await n.json()}catch{i={}}if(!n.ok){const l=(i==null?void 0:i.error)||"Unexpected server error";throw n.status===401?console.error(`[API Error] ðŸ”’ Unauthorized (401) on ${o} ${e} - Token may be invalid or expired`):n.status===403?console.error(`[API Error] ðŸš« Forbidden (403) on ${o} ${e} - Insufficient permissions`):n.status===404?console.error(`[API Error] ðŸ” Not Found (404) on ${o} ${e} - Resource does not exist`):n.status===500&&console.error(`[API Error] ðŸ’¥ Server Error (500) on ${o} ${e} - Check server logs`),new Error(l)}return i}const P={register:e=>t("/auth/register",{method:"POST",data:e}),login:e=>t("/auth/login",{method:"POST",data:e}),me:e=>t("/auth/me",{token:e}),setPin:(e,r)=>t("/auth/set-pin",{method:"POST",token:e,data:r}),verifyPin:(e,r)=>t("/auth/verify-pin",{method:"POST",token:e,data:r})},k={list:e=>t("/locks",{token:e}),create:(e,r)=>t("/locks",{method:"POST",token:e,data:r}),unlock:(e,r,o)=>t(`/locks/${r}/unlock`,{method:"POST",token:e,data:{pin:o}}),relock:(e,r,o)=>t(`/locks/${r}/relock`,{method:"POST",token:e,data:{pin:o}}),remove:(e,r,o)=>t(`/locks/${r}`,{method:"DELETE",token:e,data:{pin:o}})};export{P as a,k as t};
